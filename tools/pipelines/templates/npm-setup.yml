parameters:
  installCypress: 0

steps:
  - task: 1ESLighthouseEng.PipelineArtifactCaching.RestoreAndSaveCacheV1.RestoreAndSaveCache@1
    inputs:
      keyfile: '**/yarn.lock, !**/node_modules/**/yarn.lock, !**/.*/**/yarn.lock'
      targetfolder: '**/node_modules, !**/node_modules/**/node_modules'
      vstsFeed: '$(ArtifactFeed)'
  - script: |
      CYPRESS_INSTALL_BINARY=${{ parameters.installCypress }} yarn install --ignore-engines --frozen-lockfile
    displayName: Install dependencies only if there is no cache available
    condition: ne(variables['CacheRestored'], 'true')
